{% extends 'simple_layout.html' %}
{% block content %}

		<!--============================= DESCRIPTIONS =============================-->

		<div class="container" style="width:100%; margin:0; padding:5;">
		    <div class="span3 well" style="width:100%">
		        <center>
		        <a href="#aboutModal" data-toggle="modal" data-target="#myModal"><img src="{{url_for('static', filename=user_statistics.user.profile_picture)}}" name="aboutme" style = "width:140px; height:140px;" class="img-circle"></a>
		        <h3 style="margin-bottom: 5px; margin-top: 10px;">{{user_statistics.user.username}}</h3>
		        <!-- <?php
		        	$sub_status = check_sub($posterId, $useridPhp);
					if($sub_status == 0 && $flags == 1){
						// echo "<script type='text/javascript'>alert('shiteesfdfdk');</script>";
						echo'<button class="sub_but" id="sub_button" style="margin-top:0px; background-color: #46cd38; border-radius: 10px; border: none; color:white; /*opacity: 0.5; cursor: not-allowed;*/" type="button">SUBSCRIBE</button>';
					}
					else if($sub_status > 0 && $flags == 1){
						// echo "<script type='text/javascript'>alert('shiteesfdfdk');</script>";
						echo '<button class="sub_but" id="sub_button" style="margin-top:0px; /*background-color: #46cd38;*/ border-radius: 10px; border: none; color:grey; opacity: 0.5; /*cursor: not-allowed;*/" type="button">SUBSCRIBED</button>';
					}
					else{
						echo '<button class="sub_but" id="sub_button" style="margin-top:0px; background-color: #46cd38; border-radius: 10px; border: none; color:white; opacity:0.5;/*cursor: not-allowed;*/" type="button" disabled title="login to subscribe">SUBSCRIBE</button>';
					}
				?> -->
				{% if sub_status == 0 and current_user.is_authenticated %}
					<button class="sub_but" id="sub_button" style="margin-top:0px; background-color: #46cd38; border-radius: 10px; border: none; color:white; /*opacity: 0.5; cursor: not-allowed;*/" type="button">SUBSCRIBE</button>
				{% elif sub_status != 0 and current_user.is_authenticated %}
					<button class="sub_but" id="sub_button" style="margin-top:0px; /*background-color: #46cd38;*/ border-radius: 10px; border: none; color:grey; opacity: 0.5; /*cursor: not-allowed;*/" type="button">SUBSCRIBED</button>
				{% else %}
					<button class="sub_but" id="sub_button" style="margin-top:0px; background-color: #46cd38; border-radius: 10px; border: none; color:white; opacity:0.5;/*cursor: not-allowed;*/" type="button" disabled title="login to subscribe">SUBSCRIBE</button>
				{% endif %}
		        <div style="padding-top: 10px; margin-top: 10px;">
                    <span class="label label-success spanlabel2">{{user_statistics.num_likes}} Likes</span>
                    <span style="background-color:red" class="label label-info spanlabel2">{{user_statistics.num_dislikes}} Dislikes</span>
                    <span class="label label-warning spanlabel2">{{user_statistics.num_reviews}} Posts</span>
                    <span id="writer_subscribers" class="label label-info spanlabel2">{{user_statistics.num_subscribes}} Subscribers</span>
                    <style>
                    	.spanlabel2{
                    		text-align : center;
                    		font-size: 20px;
						  	padding : 0.5em;
						  	/*width  : 20em;*/
						  	/*height : 6em;
						  	/*border-radius: 100%;*/
                    	}
                    	.sub_but{
                    		text-align : center;
                    		font-size: 22px;
						  	/*padding : 0.5em;*/
						  	width  : 160px;
						  	height : 50px;
						  	/*border-radius: 100%;*/
                    	}
                    </style>
                    <script type="text/javascript">
						$(document).ready(function(){
							$('#sub_button').click(function(){
								var posterId = "{{user_statistics.user.id}}";
								// alert(posterId);
								$.ajax({
									url:"{{url_for('subscribe')}}",
									type:'post',
									data:JSON.stringify({"posterId":posterId}),
									contentType: 'application/json;charset=UTF-8',
									success: function(data){
										if(data.sub_status == 1){
											$("#writer_subscribers").text(data.num_subs+" Subscribers");
											$("#sub_button").text("SUBSCRIBED");
											$("#sub_button").css('background-color','grey');
											$("#sub_button").css('opacity','0.5');
										}
										else{
											$("#writer_subscribers").text(data.num_subs+" Subscribers");
											$("#sub_button").text("SUBSCRIBE");
											$("#sub_button").css('background-color','#46cd38');
											$("#sub_button").css('color','white');
											$("#sub_button").css('opacity','1');
										}
									}

								});
							});
						});
                    </script>
		        <br>
		        <br>
		        </div>
		        <em>click picuture for more</em>
				</center>
		    </div>
		    <!-- Modal -->
		    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
		        <div class="modal-dialog">
		            <div class="modal-content">
		                <div class="modal-header">
		                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
		                    <h4 class="modal-title" id="myModalLabel">More About {{user_statistics.user.username}}</h4>
		                    </div>
		                <div class="modal-body">
		                    <center>
		                    <img src="{{url_for('static', filename=user_statistics.user.profile_picture)}}" name="aboutme" border="0" class="img-circle" style = "width:140px; height:140px;"></a>
		                    <h3 class="media-heading">{{user_statistics.user.username}}</h3>
		                    <span><strong>Infos: </strong></span>
		                        <span class="label label-success spanlabel">{{user_statistics.num_likes}} Likes</span>
		                        <span style="background-color:red" class="label label-info spanlabel">{{user_statistics.num_dislikes}} Dislikes</span>
		                        <span class="label label-warning spanlabel">{{user_statistics.num_reviews}} Posts</span>
		                        <span class="label label-info spanlabel">{{user_statistics.num_subscribes}} Subscribers</span>
		                        <style>
		                        	.spanlabel{
		                        		height:50px;
		                        		padding : 0.3em;
		                        		font-size: 17px;
		                        	}
		                        </style>
		                    </center>
		                    <hr>
		                    <center>
		                    <p class="text-left"><strong>Email: </strong>
		                        {{user_statistics.user.email}}</p>
		                    <p class="text-left"><strong>Bio: </strong><br>
		                        {{user_statistics.user.bio}}</p>
		                    <br>
		                    </center>
		                </div>
		                <div class="modal-footer">
		                    <center>
		                    <button type="button" class="btn btn-default" data-dismiss="modal">Minimize</button>
		                    </center>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>
		<!--//END DESCRIPTION -->
		
		<!--============================= REVIEW DETAILS =============================-->
		<div id="reviews" class="tabcontent">
			<section class="main-block">
				<div class="container" id="row_of_review">
					<div class="row justify-content-center">
						<div class="col-md-5">
							<div class="styled-heading">
								<h3>{{review_type.section_name}}</h3>
							</div>
						</div>
					</div>
					<div class="row" > <!-- LIKED REIVEWS -->
						{% for review in review_type.reviews %}
						<div class="col-md-4 featured-responsive">
							<div class="featured-place-wrap">
								<a href="{{url_for('detail', review_id=review.review.id)}}">
									<img src="{{review.thumbnail}}" class="img-fluid" alt="thumbnail">
									<span class="{{review.rating_class}}">{{review.review.rating}}</span>
									<div class="featured-title-box">
										<h6 name="store_name">{{review.review.ten}}</h6>
										<p name="store_type">{{review.loai}}</p>
										<!--<p><span>$$$</span>$$</p>--> <!-- Based on price range -->
										<ul>
											<li><span class="ti-location-pin"></span>
												<p name="store_address">{{review.review.dia_chi}}</p>
											</li>
											<li><span class="fa fa-tag minmaxpriceicon"></span>
												<p name="store_pricerange"> 
													{% if review.price_range[0] == review.price_range[1] %}
															{{review.price_range[0]}}
													{% else %}
															{{review.price_range[0]}} - {{review.price_range[1]}}
													{% endif %}
												</p>
											</li>
											<li><span class="ti-time"></span>
												<p name="store_opening">{{review.review.time_open}} - {{review.review.time_close}}</p>
											</li>
										</ul>
										<h4 style="font-style:italic; font-size: 15px; color:grey;">{{review.review.author.username}}</h4>
										<div class="bottom-icons">
											{% if review.openning %}
												<div class="open-now">OPEN NOW</div> <!-- Based on opening time -->
											{% else %}
												<div class="closed-now">CLOSED NOW</div> <!-- Based on opening time -->
											{% endif %}
											<span class="ti-heart"><span class="upvote display-number" name="store_point">{{review.review_likes}}</span></span> 
											<!-- Number of upvotes - number of downvotes -->
											<span class="ti-comments"><span class="comment display-number" name="no_comments">{{review.comments}}</span></span>
										</div>
									</div>
								</a>
							</div>
						</div>
						{% endfor %}
					</div> 				
				</div>
			<div class="featured_btn_wrap"  style="width:100%">
				<button class="wtf view_more_button" id="view_more_button">XEM THÃŠM</button> 
			</div>
			</section>
			<hr>
		</div>
		<!-- POSTED REVIEWS END -->
		<script>
			$(document).ready(function(){						
				var last_id = "{{review_type.reviews[-1].review.id}}";
				$(".wtf").click(function(){
					var search_type = "{{review_type.search_type}}"
					// alert(search_type);
					$.ajax({
						url:"{{url_for('load_reviews')}}",
						type:'post',
						data: JSON.stringify({"last_id":last_id, "search_type": search_type, "user_id":"{{user_statistics.user.id}}"}),
						contentType: 'application/json;charset=UTF-8',
						success: function(datas){
							// alert('success');
							var large = '<div class="row"> ';
							for (i=0; i<datas['reviews'].length; i++){
								data = datas['reviews']
								large += '<div class="col-md-4 featured-responsive">	                    <div class="featured-place-wrap">	                        <a href="'+data[i].url+'">	                            <img src="'+data[i].thumbnail+'" class="img-fluid" alt="#">	                            <span class="'+data[i].rating_class+'">'+data[i].rating+'</span>	                            <div class="featured-title-box">	                                <h6>'+data[i].ten+'</h6>	                                <p>'+data[i].loai+'</p>	                                <ul>	                                    <li><span class="ti-location-pin"></span>	                                        <p name="store_name">'+data[i].dia_chi+'</p>	                                    </li>	                                    <li><span class="fa fa-tag minmaxpriceicon"></span>	                                        <p name="store_pricerange">'+data[i].price_range[0]+' - '+data[i].price_range[0]+'</p>	                                    </li>	                                    <li><span class="ti-time"></span>	                                        <p name="store_opening">'+data[i].time_open+' - '+data[i].time_close+'</p>	                                    </li>	                                </ul><h4 style="font-style:italic; font-size: 15px; color:grey;">'+ data[i].author+'</h4>	                                <div class="bottom-icons">	                                    <div class="'+data[i].time_class+'">'+data[i].store_status+'</div>	                                    <span class="ti-heart"><span class="upvote display-number" name="no_upvotes">'+data[i].review_likes+'</span></span>	                                    <span class="ti-comments"><span class="comment display-number" name="no_comments">'+data[i].comments+'</span></span>	                                </div>	                            </div>	                        </a>	                    </div>	                </div>';
							}
							large += '</div>';
							$("#row_of_review").append(large);
							last_id = datas.next_last_id;
						}
					});		
				});
			});
		</script>
		<!--=================================== END REVIEW DETAILS ==================================-->
{% endblock content %}